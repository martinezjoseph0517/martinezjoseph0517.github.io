"0","library(quantmod)"
"0","library(dplyr)"
"0","library(zoo)"
"0","library(plotly)"
"0",""
"0","# Load data"
"0","symbols <- c(""SPY"", ""QQQ"", ""DIA"")"
"0","getSymbols(symbols, src = ""yahoo"", from = ""2020-01-01"", to = ""2025-01-01"")"
"1","[1]"
"1"," ""SPY"""
"1"," ""QQQ"""
"1"," ""DIA"""
"1","
"
"0","# Process ETF data function"
"0","process_etf <- function(etf_xts, etf_symbol) {"
"0","  df <- data.frame(Date = index(etf_xts), coredata(etf_xts))"
"0","  close_col <- df[, grep(""Close"", names(df))]"
"0","  "
"0","  df %>%"
"0","    mutate("
"0","      ETF = etf_symbol,"
"0","      Close = close_col,"
"0","      Daily_Return = (Close - lag(Close)) / lag(Close),"
"0","      MA_50 = zoo::rollmean(Close, 50, fill = NA, align = ""right""),"
"0","      MA_200 = zoo::rollmean(Close, 200, fill = NA, align = ""right"")"
"0","    ) %>%"
"0","    filter(!is.na(Daily_Return))"
"0","}"
"0",""
"0","SPY_df <- process_etf(SPY, ""SPY"")"
"0","QQQ_df <- process_etf(QQQ, ""QQQ"")"
"0","DIA_df <- process_etf(DIA, ""DIA"")"
"0",""
"0","all <- bind_rows(SPY_df, QQQ_df, DIA_df)"
"0",""
"0","p <- plot_ly(all, x = ~Date)"
"0",""
"0","# Trace index groups"
"0","trace_index <- list("
"0","  SPY = c(1,2,3),"
"0","  QQQ = c(4,5,6),"
"0","  DIA = c(7,8,9)"
"0",")"
"0",""
"0","# SPY traces"
"0","p <- p %>%"
"0","  add_lines(data = SPY_df, y = ~Close, name = ""SPY Price"") %>%"
"0","  add_lines(data = SPY_df, y = ~MA_50, name = ""SPY MA50"", line = list(dash = ""dash"")) %>%"
"0","  add_lines(data = SPY_df, y = ~MA_200, name = ""SPY MA200"", line = list(dash = ""dot""))"
"0",""
"0","# QQQ traces"
"0","p <- p %>%"
"0","  add_lines(data = QQQ_df, y = ~Close, name = ""QQQ Price"") %>%"
"0","  add_lines(data = QQQ_df, y = ~MA_50, name = ""QQQ MA50"", line = list(dash = ""dash"")) %>%"
"0","  add_lines(data = QQQ_df, y = ~MA_200, name = ""QQQ MA200"", line = list(dash = ""dot""))"
"0",""
"0","# DIA traces"
"0","p <- p %>%"
"0","  add_lines(data = DIA_df, y = ~Close, name = ""DIA Price"") %>%"
"0","  add_lines(data = DIA_df, y = ~MA_50, name = ""DIA MA50"", line = list(dash = ""dash"")) %>%"
"0","  add_lines(data = DIA_df, y = ~MA_200, name = ""DIA MA200"", line = list(dash = ""dot""))"
"0",""
"0","# Function to show/hide ETF groups"
"0","make_visibility <- function(show_etfs) {"
"0","  visible <- rep(FALSE, 9)"
"0","  for (etf in show_etfs) visible[trace_index[[etf]]] <- TRUE"
"0","  visible"
"0","}"
"0",""
"0","# Apply Lux-style theme"
"0","p <- p %>%"
"0","  layout("
"0","    title = list("
"0","      text = ""ETF Comparison (Lux Theme)"","
"0","      font = list(size = 20, family = ""Arial"", color = ""#333333"")"
"0","    ),"
"0","    plot_bgcolor = ""#f8f9fa"",   # Lux background light-gray"
"0","    paper_bgcolor = ""#ffffff"","
"0","    xaxis = list("
"0","      title = ""Date"","
"0","      gridcolor = ""#e9ecef"",    # subtle Lux grid"
"0","      linecolor = ""#ced4da"","
"0","      zerolinecolor = ""#e9ecef"","
"0","      tickfont = list(color = ""#495057""),"
"0","      titlefont = list(color = ""#495057"")"
"0","    ),"
"0","    yaxis = list("
"0","      title = ""Price"","
"0","      gridcolor = ""#e9ecef"","
"0","      linecolor = ""#ced4da"","
"0","      zerolinecolor = ""#e9ecef"","
"0","      tickfont = list(color = ""#495057""),"
"0","      titlefont = list(color = ""#495057"")"
"0","    ),"
"0","    legend = list("
"0","      bgcolor = ""rgba(255,255,255,0)"","
"0","      bordercolor = ""#dee2e6"","
"0","      borderwidth = 1,"
"0","      font = list(color = ""#333333"")"
"0","    ),"
"0","    updatemenus = list("
"0","      list("
"0","        type = ""buttons"","
"0","        direction = ""right"","
"0","        x = 0.5, y = 1.15,"
"0","        showactive = TRUE,"
"0","        bgcolor = ""#e9ecef"","
"0","        bordercolor = ""#adb5bd"","
"0","        buttons = list("
"0","          list(label = ""All"", method = ""restyle"","
"0","               args = list(""visible"", make_visibility(c(""SPY"",""QQQ"",""DIA"")))),"
"0","          list(label = ""SPY"", method = ""restyle"","
"0","               args = list(""visible"", make_visibility(c(""SPY"")))),"
"0","          list(label = ""QQQ"", method = ""restyle"","
"0","               args = list(""visible"", make_visibility(c(""QQQ"")))),"
"0","          list(label = ""DIA"", method = ""restyle"","
"0","               args = list(""visible"", make_visibility(c(""DIA""))))"
"0","        )"
"0","      )"
"0","    )"
"0","  )"
"0",""
"0","p"
